<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>БРИГАДА ПЛЕЕР v1.2</title>
    <!-- Скрипт Telegram -->
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <!-- Пиксельный шрифт -->
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
    <style>
        :root {
            --explosive-orange: #ff8a00;
            --neon-cyan: #00f0ff;
            --hp-green: #39ff14;
            --bg-dark: #0a0a0a;
        }

        body {
            background-color: var(--bg-dark);
            background-image: radial-gradient(circle, #1a1a1a 1px, transparent 1px);
            background-size: 20px 20px;
            color: white;
            font-family: 'Press Start 2P', cursive;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-transform: uppercase;
        }

        .header-title {
            font-size: 10px;
            color: white;
            margin-bottom: 20px;
            text-shadow: 2px 2px 0px red;
            text-align: center;
        }

        /* Главная карточка */
        .player-card {
            border: 4px solid white;
            box-shadow: 8px 8px 0px var(--explosive-orange);
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            width: 100%;
            max-width: 340px;
            box-sizing: border-box;
        }

        /* Обложка трека */
        .album-art {
            width: 100%;
            height: 250px;
            border: 4px solid var(--neon-cyan);
            margin-bottom: 20px;
            background-color: #000;
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: flex-end;
            position: relative;
            box-sizing: border-box;
            transition: background-image 0.3s ease-in-out;
        }

        .album-art::after {
            content: "LIVE_ACTION";
            background: red;
            color: white;
            font-size: 8px;
            padding: 4px;
            position: absolute;
            top: 5px;
            right: 5px;
        }

        .track-info h2 { font-size: 11px; color: var(--neon-cyan); margin: 10px 0; line-height: 1.4; height: 30px; overflow: hidden; }
        .track-info p { font-size: 8px; color: var(--explosive-orange); margin-bottom: 20px; }

        .hp-label { font-size: 7px; text-align: left; margin-bottom: 8px; display: block; color: #aaa; }
        
        .progress-container {
            width: 100%;
            height: 14px;
            background: #222;
            border: 2px solid white;
            margin-bottom: 20px;
            cursor: pointer;
            box-sizing: border-box;
        }

        .progress-bar {
            width: 0%;
            height: 100%;
            background: var(--hp-green);
            box-shadow: 0 0 10px var(--hp-green);
        }

        .controls {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }

        .btn {
            background: white;
            border: none;
            padding: 10px;
            font-family: 'Press Start 2P', cursive;
            cursor: pointer;
            font-size: 10px;
            flex: 1;
            box-shadow: 4px 4px 0px #555;
            outline: none;
        }

        .btn:active {
            box-shadow: 0px 0px 0px;
            transform: translate(2px, 2px);
        }

        .btn-play {
            background: var(--explosive-orange);
            color: white;
            flex: 2;
        }

        .playlist {
            width: 100%;
            max-width: 340px;
            margin-top: 25px;
        }

        .playlist-item {
            font-size: 8px;
            padding: 12px;
            border: 2px solid #333;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            background: #111;
            cursor: pointer;
        }

        .playlist-item:hover {
            border-color: var(--neon-cyan);
            color: var(--neon-cyan);
        }

        .playlist-item.active {
            border-color: var(--hp-green);
            color: var(--hp-green);
        }

        .playlist-item span { margin-right: 10px; color: var(--explosive-orange); }

    </style>
</head>
<body>

    <div class="header-title">БРИГАДА: МУЗЫКАЛЬНЫЙ ТЕРМИНАЛ</div>

    <div class="player-card">
        <div class="album-art" id="art">
             <div style="background: rgba(0,0,0,0.6); width: 100%; padding: 5px; font-size: 7px;">STATUS: ONLINE</div>
        </div>
        
        <div class="track-info">
            <h2 id="title">INIT...</h2>
            <p id="artist">SYSTEM</p>
        </div>

        <span class="hp-label">HP / PROGRESS</span>
        <div class="progress-container" id="progress-container">
            <div class="progress-bar" id="progress"></div>
        </div>

        <div class="controls">
            <button class="btn" id="prev"><</button>
            <button class="btn btn-play" id="play">START</button>
            <button class="btn" id="next">></button>
        </div>
    </div>

    <div class="playlist" id="playlist-container"></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.ready();

        const audio = new Audio();
        let currentTrackIndex = 0;
        let isPlaying = false;

        // 1. ПУТЬ К ТВОЕМУ ПОСТЕРУ ПО УМОЛЧАНИЮ
        const defaultImg = "poster.jpg";

        // 2. СПИСОК ТРЕКОВ
        const tracks = [
            {
                title: "BRIGADA MAIN THEME",
                artist: "OST REMIX",
                url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3",
                img: "poster.jpg" // Явно указываем постер
            },
            {
                title: "CRYPTO LOX BEAT",
                artist: "B-BROILER",
                url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3",
                img: "https://via.placeholder.com/300/00f0ff/000000?text=BEAT" // Своя обложка
            },
            {
                title: "GANGSTA TRACK",
                artist: "NORMAL PAZAN",
                url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3"
                // Тут картинки нет — сработает логика defaultImg!
            }
        ];

        const playBtn = document.getElementById('play');
        const title = document.getElementById('title');
        const artist = document.getElementById('artist');
        const art = document.getElementById('art');
        const progress = document.getElementById('progress');
        const progressContainer = document.getElementById('progress-container');
        const playlistContainer = document.getElementById('playlist-container');

        function loadTrack(index) {
            const track = tracks[index];
            title.innerText = track.title;
            artist.innerText = track.artist;
            audio.src = track.url;
            
            // ЛОГИКА ОБЛОЖКИ: Если track.img существует — берем его, если нет — defaultImg
            const imgToDisplay = track.img ? track.img : defaultImg;
            art.style.backgroundImage = `url('${imgToDisplay}')`;

            // Подсветка активного трека в списке
            updatePlaylistUI(index);
        }

        function updatePlaylistUI(activeIndex) {
            const items = document.querySelectorAll('.playlist-item');
            items.forEach((item, idx) => {
                if (idx === activeIndex) item.classList.add('active');
                else item.classList.remove('active');
            });
        }

        function togglePlay() {
            if (isPlaying) {
                audio.pause();
                playBtn.innerText = 'START';
            } else {
                audio.play().catch(e => console.log("Нажми START для активации"));
                playBtn.innerText = 'STOP';
            }
            isPlaying = !isPlaying;
        }

        audio.addEventListener('timeupdate', () => {
            if (audio.duration) {
                const percent = (audio.currentTime / audio.duration) * 100;
                progress.style.width = percent + '%';
            }
        });

        progressContainer.addEventListener('click', (e) => {
            const width = progressContainer.clientWidth;
            const clickX = e.offsetX;
            if (audio.duration) audio.currentTime = (clickX / width) * audio.duration;
        });

        tracks.forEach((track, index) => {
            const item = document.createElement('div');
            item.className = 'playlist-item';
            item.innerHTML = `<span>[0${index+1}]</span> ${track.title}`;
            item.onclick = () => {
                currentTrackIndex = index;
                loadTrack(index);
                if (!isPlaying) togglePlay(); else audio.play();
            };
            playlistContainer.appendChild(item);
        });

        playBtn.addEventListener('click', togglePlay);
        
        document.getElementById('next').onclick = () => {
            currentTrackIndex = (currentTrackIndex + 1) % tracks.length;
            loadTrack(currentTrackIndex);
            if (isPlaying) audio.play();
        };

        document.getElementById('prev').onclick = () => {
            currentTrackIndex = (currentTrackIndex - 1 + tracks.length) % tracks.length;
            loadTrack(currentTrackIndex);
            if (isPlaying) audio.play();
        };

        // Запуск системы
        loadTrack(0);
    </script>
</body>
</html>